{
  "mqtt": {
    "broker": "localhost",
    "port": 1883,
    "username": "mower",
    "password": "smart",
    "root_topic": "smartmower",
    "topics": {
      "camera": {
        "base": "vision/camera",
        "subtopics": { "data": "data", "status": "status", "commands": "commands" },
        "qos": 1,
        "retain": false
      },
      "pico": {
        "base": "bridge/pico",
        "subtopics": { "data": "data", "status": "status", "commands": "commands" },
        "qos": 1,
        "retain": false,
        "keepalive": 60
      },
      "gps": {
        "base": "bridge/gps",
        "subtopics": { "data": "data", "status": "status", "commands": "commands" },
        "qos": 1,
        "retain": false,
        "keepalive": 60
      },
      "safety": {
        "base": "safety",
        "subtopics": { "state": "state", "estop": "estop", "commands": "commands" },
        "qos": 1,
        "retain": false
      },
      "state_machine": {
        "base": "state_machine",
        "subtopics": { "state": "state", "event": "event", "transition": "transition", "commands": "commands" },
        "qos": 1,
        "retain": false,
        "states": {
          "STATE_INIT": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop",
              "smartmower/bridge/pico/status",
              "smartmower/bridge/gps/status",
              "smartmower/vision/camera/status"
            ],
            "allowed_events": [
              "EVENT_INIT_COMPLETE",
              "EVENT_EMERGENCY_STOP",
              "EVENT_TIMEOUT",
              "EVENT_ERROR_OCCURRED"
            ],
            "transitions": [
              { "on": "EVENT_INIT_COMPLETE", "to": "STATE_IDLE" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_TIMEOUT", "to": "STATE_ERROR" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" }
            ]
          },
          "STATE_IDLE": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop",
              "smartmower/bridge/pico/status",
              "smartmower/bridge/gps/status"
            ],
            "allowed_events": [
              "EVENT_START_MOWING",
              "EVENT_MANUAL_CONTROL",
              "EVENT_EMERGENCY_STOP",
              "EVENT_ERROR_OCCURRED",
              "EVENT_BATTERY_LOW"
            ],
            "transitions": [
              { "on": "EVENT_START_MOWING", "to": "STATE_UNDOCKING" },
              { "on": "EVENT_MANUAL_CONTROL", "to": "STATE_MANUAL_CONTROL" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" },
              { "on": "EVENT_BATTERY_LOW", "to": "STATE_DOCKING" }
            ]
          },
          "STATE_MANUAL_CONTROL": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop",
              "smartmower/state_machine/commands"
            ],
            "allowed_events": [
              "EVENT_END_MANUAL_CONTROL",
              "EVENT_EMERGENCY_STOP",
              "EVENT_ERROR_OCCURRED"
            ],
            "transitions": [
              { "on": "EVENT_END_MANUAL_CONTROL", "to": "STATE_IDLE" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" }
            ]
          },
          "STATE_MOWING": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_PAUSE",
              "EVENT_EMERGENCY_STOP",
              "EVENT_BATTERY_LOW",
              "EVENT_OBSTACLE_DETECTED",
              "EVENT_PERIMETER_CROSSED",
              "EVENT_AREA_COMPLETE",
              "EVENT_ERROR_OCCURRED"
            ],
            "transitions": [
              { "on": "EVENT_PAUSE", "to": "STATE_PAUSED" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_BATTERY_LOW", "to": "STATE_DOCKING" },
              { "on": "EVENT_OBSTACLE_DETECTED", "to": "STATE_PAUSED" },
              { "on": "EVENT_PERIMETER_CROSSED", "to": "STATE_PAUSED" },
              { "on": "EVENT_AREA_COMPLETE", "to": "STATE_DOCKING" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" }
            ]
          },
          "STATE_CHARGING": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_BATTERY_FULL",
              "EVENT_START_MOWING",
              "EVENT_MANUAL_CONTROL",
              "EVENT_EMERGENCY_STOP",
              "EVENT_ERROR_OCCURRED"
            ],
            "transitions": [
              { "on": "EVENT_BATTERY_FULL", "to": "STATE_IDLE" },
              { "on": "EVENT_START_MOWING", "to": "STATE_UNDOCKING" },
              { "on": "EVENT_MANUAL_CONTROL", "to": "STATE_MANUAL_CONTROL" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" }
            ]
          },
          "STATE_EMERGENCY_STOP": {
            "consumes": [
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_EMERGENCY_RECOVER"
            ],
            "transitions": [
              { "on": "EVENT_EMERGENCY_RECOVER", "to": "STATE_IDLE" }
            ]
          },
          "STATE_UNDOCKING": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_UNDOCKING_COMPLETE",
              "EVENT_EMERGENCY_STOP",
              "EVENT_PAUSE",
              "EVENT_ERROR_OCCURRED",
              "EVENT_TIMEOUT",
              "EVENT_OBSTACLE_DETECTED",
              "EVENT_PERIMETER_CROSSED"
            ],
            "transitions": [
              { "on": "EVENT_UNDOCKING_COMPLETE", "to": "STATE_MOWING" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_PAUSE", "to": "STATE_PAUSED" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" },
              { "on": "EVENT_TIMEOUT", "to": "STATE_ERROR" },
              { "on": "EVENT_OBSTACLE_DETECTED", "to": "STATE_PAUSED" },
              { "on": "EVENT_PERIMETER_CROSSED", "to": "STATE_PAUSED" }
            ]
          },
          "STATE_DOCKING": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_DOCKING_COMPLETE",
              "EVENT_EMERGENCY_STOP",
              "EVENT_ERROR_OCCURRED",
              "EVENT_TIMEOUT",
              "EVENT_OBSTACLE_DETECTED"
            ],
            "transitions": [
              { "on": "EVENT_DOCKING_COMPLETE", "to": "STATE_CHARGING" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" },
              { "on": "EVENT_TIMEOUT", "to": "STATE_ERROR" },
              { "on": "EVENT_OBSTACLE_DETECTED", "to": "STATE_PAUSED" }
            ]
          },
          "STATE_ERROR": {
            "consumes": [
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_ERROR_RECOVER",
              "EVENT_EMERGENCY_STOP"
            ],
            "transitions": [
              { "on": "EVENT_ERROR_RECOVER", "to": "STATE_IDLE" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" }
            ]
          },
          "STATE_PAUSED": {
            "consumes": [
              "smartmower/safety/state",
              "smartmower/safety/estop"
            ],
            "allowed_events": [
              "EVENT_RESUME",
              "EVENT_EMERGENCY_STOP",
              "EVENT_ERROR_OCCURRED",
              "EVENT_BATTERY_LOW"
            ],
            "transitions": [
              { "on": "EVENT_RESUME", "to": "STATE_MOWING" },
              { "on": "EVENT_EMERGENCY_STOP", "to": "STATE_EMERGENCY_STOP" },
              { "on": "EVENT_ERROR_OCCURRED", "to": "STATE_ERROR" },
              { "on": "EVENT_BATTERY_LOW", "to": "STATE_DOCKING" }
            ]
          }
        }
      },
      "slam": {
        "base": "slam",
        "subtopics": { "pose": "pose", "status": "status" },
        "qos": 1,
        "retain": false
      },
      "navigation": {
        "base": "nav",
        "subtopics": { "map": "map", "costmap_status": "costmap/status" },
        "qos": 1,
        "retain": false
      }
    }
  },

  "camera": {
    "type": "rpi",
    "width": 1280,
    "height": 720,
    "fps": 15,
    "quality": 85
  },

  "gps_config": {
    "uart_device": "/dev/ttyAMA2",
    "baudrate": 115200,
    "uart_timeout_ms": 1000,
    "protocol": "NMEA",
    "max_satellites": 24,
    "log_raw_data": false
  },
  "gps_logging": {
    "level": "info",
    "file": "/opt/smartmower/log/gps_bridge.log",
    "max_size_mb": 10,
    "max_files": 5
  },

  "pico_config": {
    "uart_device": "/dev/ttyAMA1",
    "baudrate": 115200,
    "uart_timeout_ms": 1000
  },
  "pico_logging": {
    "level": "debug",
    "file": "/opt/smartmower/log/pico_bridge.log",
    "data_dir": "/opt/smartmower/data/pico"
  },

  "state_machine": {
    "timeouts": {
      "init_timeout": 30,
      "undocking_timeout": 120,
      "docking_timeout": 300,
      "manual_control_timeout": 600,
      "charging_timeout": 14400,
      "error_timeout": 300,
      "component_heartbeat_timeout": 10,
      "gps_timeout": 5000,
      "vision_timeout": 100
    },
    "events": [
      "EVENT_INIT_COMPLETE",
      "EVENT_START_MOWING",
      "EVENT_BATTERY_LOW",
      "EVENT_BATTERY_FULL",
      "EVENT_EMERGENCY_STOP",
      "EVENT_MANUAL_CONTROL",
      "EVENT_ERROR_OCCURRED",
      "EVENT_PAUSE",
      "EVENT_RESUME",
      "EVENT_EMERGENCY_RECOVER",
      "EVENT_DOCKING_COMPLETE",
      "EVENT_UNDOCKING_COMPLETE",
      "EVENT_OBSTACLE_DETECTED",
      "EVENT_PERIMETER_CROSSED",
      "EVENT_AREA_COMPLETE",
      "EVENT_TIMEOUT",
      "EVENT_PICO_CONNECTED",
      "EVENT_GPS_CONNECTED"
    ]
  },

  "slam_config": {
    "subscriptions": {
      "vodometry": "smartmower/vision/odometry/data",
      "vobstacle": "smartmower/vision/obstacle/data",
      "gps": "smartmower/bridge/gps/data",
      "pico": "smartmower/bridge/pico/data",
      "pico_status": "smartmower/bridge/pico/status"
    },
    "initial_position": {
      "x": 0.0,
      "y": 0.0,
      "z": 0.0
    },
    "initial_orientation": {
      "w": 1.0,
      "x": 0.0,
      "y": 0.0,
      "z": 0.0
    },
    "mapping": {
      "resolution": 0.1,
      "width_meters": 100.0,
      "height_meters": 100.0,
      "origin_x": 0.0,
      "origin_y": 0.0
    },
    "obstacle_detection": {
      "min_distance": 0.3,
      "max_distance": 4.0,
      "filter_window_size": 5
    },
    "sensor_fusion": {
      "sensor_weights": { "magnetometer": 0.3 },
      "mag_declination_deg": 0.0,
      "mag_calibration": {
        "offset": { "x": 0.0, "y": 0.0, "z": 0.0 },
        "scale": { "x": 1.0, "y": 1.0, "z": 1.0 },
        "align_matrix": [
          [1.0, 0.0, 0.0],
          [0.0, 1.0, 0.0],
          [0.0, 0.0, 1.0]
        ]
      }
    }
  },

  "navigation": {
    "map": {
        "resolution_m": 0.1,
        "inflation_radius_m": 0.3,
        "publish_rate_hz": 2,
        "obstacle_timeout_s": 5
    }
  },

  "system": {
    "safety": {
      "emergency_stop_enabled": true,
      "lift_sensor_enabled": true,
      "theft_alarm_enabled": true,
      "geofence_enabled": true,
      "geofence": {
        "enabled": true,
        "polygon": [
          [45.4642, 9.19],
          [45.4643, 9.19],
          [45.4643, 9.1901],
          [45.4642, 9.1901]
        ]
      }
    },
    "hardware": {
      "dimensions": {
        "robot_length": 0.6,
        "robot_width": 0.4,
        "robot_height": 0.25,
        "wheel_base": 0.35,
        "wheel_diameter": 0.2,
        "wheel_track": 0.3,
        "ground_clearance": 0.05,
        "weight": 15
      },
      "blade": {
        "diameter": 0.18,
        "offset_x": 0.25,
        "offset_y": 0,
        "cutting_deck_width": 0.2
      },
      "motors": {
        "motors_max_rpm": 5000,
        "motors_gear_ratio": 185,
        "motors_encoder_pulses_per_rev": 12,
        "blade_motor_max_rpm": 6000,
        "blade_motor_gear_ratio": 1,
        "blade_motor_encoder_pulses_per_rev": 6
      }
    },
    "battery": {
      "type": "lifepo4_8s",
      "low_threshold": 30,
      "profiles": {
        "lifepo4_8s": {
          "type": "lithium_iron_phosphate",
          "cells": 8,
          "nominal_voltage_per_cell": 3.2,
          "max_voltage_per_cell": 3.6,
          "min_voltage_per_cell": 2.5,
          "capacity_ah": 12,
          "nominal_pack_voltage": 25.6,
          "max_pack_voltage": 28.8,
          "min_pack_voltage": 20.0,
          "charging": {
            "full_voltage_per_cell": 3.55,
            "trickle_current_ma": 300,
            "stable_time_seconds": 800,
            "current_threshold_ma": 150
          },
          "per_cell_curve": {
            "100": 3.6,
            "90": 3.4,
            "80": 3.35,
            "70": 3.32,
            "60": 3.3,
            "50": 3.28,
            "40": 3.26,
            "30": 3.24,
            "20": 3.2,
            "10": 3.0,
            "5": 2.8,
            "0": 2.5
          },
          "ocv_to_pct": [
            [20.0, 0],
            [22.4, 5],
            [24.0, 10],
            [25.6, 20],
            [25.92, 30],
            [26.08, 40],
            [26.24, 50],
            [26.4, 60],
            [26.56, 70],
            [26.8, 80],
            [27.2, 90],
            [28.8, 100]
          ]
          }
        }
    },
    "supervisor": {
      "autostart": false
    }
  },

  "metadata": {
    "config_version": "1.1",
    "robot_id": "smartmower_001",
    "last_modified": "2025-08-20T23:21:09+02:00"
  }
}
